const klaw = require('klaw')
const copyTemplate = require('./copy-template')
const path = require('path')

module.exports = (copyFrom, copyTo, data) => {
  return new Promise((resolve, reject) => {
    const files = []

    klaw(copyFrom)
      .on('data', async (file) => {
        // Exclude directories
        if (
          file.stats.isDirectory() ||
          file.path.includes('.DS_Store')
        ) return
        files.push(file)

        try {
          const output = path.relative(copyFrom, file.path)
          await copyTemplate(file.path, path.resolve(copyTo, output), data)
        } catch (e) {
          reject(e)
        }
      })
      .on('end', () => resolve(files))
      .on('error', reject)
  })
}
