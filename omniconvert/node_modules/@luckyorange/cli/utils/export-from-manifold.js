const {SecretManagerServiceClient} = require('@google-cloud/secret-manager')

async function start () {
  const client = new SecretManagerServiceClient()

  const promises = Object
    .keys(process.env)
    .filter(key => key.startsWith('LO_'))
    .map(async (key) => {
      const [secret] = await client.createSecret({
        parent: 'projects/lucky-orange',
        secretId: key,
        secret: {
          replication: {
            automatic: {}
          }
        }
      })

      const [version] = await client.addSecretVersion({
        parent: `projects/lucky-orange/secrets/${key}`,
        payload: {
          data: Buffer.from(process.env[key], 'utf8')
        }
      })
    })

  return Promise.all(promises)
}

start().then(() => console.log('Done!'))